<!DOCTYPE html>
<html th:replace="~{plantilla_admin :: layout_base(~{::section}, ~{::script})}" xmlns:th="http://www.w3.org/1999/xhtml">

<body>

<section>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }


        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 32px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        h1 {
            color: #2757F5;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 28px;
            text-align: center;
        }

        h3 {
            color: #2757F5;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 16px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 13.5px;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 9px 12px;
            border: 1.5px solid #d9e2ef;
            border-radius: 6px;
            font-size: 13.5px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: #fafbfc;
            color: #2c3e50;
        }

        input:focus {
            outline: none;
            border-color: #2757F5;
            background: white;
            box-shadow: 0 0 0 3px rgba(39, 87, 245, 0.1);
        }

        input::placeholder {
            color: #9ca3af;
        }

        small {
            display: block;
            color: #9ca3af;
            font-size: 12px;
            margin-top: 4px;
            font-weight: 400;
        }

        .preview-box {
            margin-top: 24px;
            background: #f0f4ff;
            padding: 16px 18px;
            border-radius: 8px;
            border: 1px solid #d9e2ef;
        }

        .preview-box h3 {
            margin-top: 0;
            color: #2757F5;
        }

        #lista-simulada {
            margin-top: 12px;
        }

        .preview-item {
            padding: 10px 12px;
            margin: 6px 0;
            background: white;
            border: 1px solid #e8eef5;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 13.5px;
            color: #2c3e50;
        }

        .preview-item strong {
            color: #2757F5;
        }

        .item-nuevo {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(13, 110, 253, 0.15);
            border-left: 4px solid #28a745;
        }

        .item-desplazado {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .item-sin-cambios {
            color: #9ca3af;
        }

        .flecha-cambio {
            color: #2757F5;
            font-weight: 600;
            margin-left: 6px;
        }

        hr {
            border: none;
            border-top: 1px solid #e8eef5;
            margin: 28px 0;
        }

        .button-group {
            display: flex;
            gap: 12px;
        }

        button,
        a {
            flex: 1;
            padding: 11px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        button {
            background: linear-gradient(135deg, #2757F5 0%, #1e44c9 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(39, 87, 245, 0.25);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(39, 87, 245, 0.35);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(39, 87, 245, 0.3);
        }

        a.btn-cancel {
            background: white;
            color: #2757F5;
            border: 2px solid #2757F5;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        a.btn-cancel:hover {
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 87, 245, 0.2);
        }

        @media (max-width: 1024px) {
            body {
                padding-left: 24px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }

            .container {
                padding: 24px 20px;
            }

            h1 {
                font-size: 20px;
            }

            .preview-item {
                font-size: 12px;
                padding: 8px 10px;
            }

            .button-group {
                flex-direction: column-reverse;
            }

            button,
            a {
                width: 100%;
            }
        }
    </style>
    <div class="container">
        <h1>Crear Nueva Sección</h1>

        <form th:action="@{/admin/formulario/seccion/guardar}" method="post" th:object="${seccion}">

            <div class="form-group">
                <label for="nombre">Nombre de la Sección</label>
                <input type="text" id="nombre" th:field="*{nombre}" required placeholder="Ej: Datos Demográficos" oninput="actualizarVistaPrevia()">
            </div>

            <div class="form-group">
                <label for="numero">Número de Orden (Posición)</label>
                <input type="number" id="numero" th:field="*{numero}" min="1" required placeholder="1" oninput="actualizarVistaPrevia()">
                <small>Modifica este número para ver cómo se reordenan las secciones abajo.</small>
            </div>

            <div class="preview-box">
                <h3>Vista Previa del Orden</h3>
                <div id="lista-simulada"></div>
            </div>

            <hr>

            <div class="button-group">
                <a href="#" th:href="@{/admin/formulario/crear-formulario}" class="btn-cancel" onclick="history.back(); return false;">Cancelar</a>
                <button type="submit">Guardar Sección</button>
            </div>
        </form>
    </div>

</section>

<script th:inline="javascript">

    var seccionesOriginales = [[${secciones}]] || [];

    function actualizarVistaPrevia() {
        var inputNum = document.getElementById('numero');
        var inputNom = document.getElementById('nombre');

        var nuevoNumero = parseInt(inputNum.value) || 1;
        var nuevoNombre = inputNom.value || "NUEVA SECCIÓN";
        var contenedor = document.getElementById('lista-simulada');

        if (!contenedor) return;
        contenedor.innerHTML = "";

        var listaSimulada = [];

        seccionesOriginales.forEach(function(s) {
            var item = { nombre: s.nombre, numeroOriginal: s.numero };

            if (s.numero >= nuevoNumero) {
                item.numeroNuevo = s.numero + 1;
                item.estado = 'desplazado';
            } else {
                item.numeroNuevo = s.numero;
                item.estado = 'fijo';
            }
            listaSimulada.push(item);
        });

        listaSimulada.push({
            nombre: nuevoNombre,
            numeroNuevo: nuevoNumero,
            estado: 'nuevo'
        });

        listaSimulada.sort((a, b) => a.numeroNuevo - b.numeroNuevo);

        listaSimulada.forEach(function(item) {
            var div = document.createElement('div');
            div.className = 'preview-item';

            if (item.estado === 'nuevo') div.classList.add('item-nuevo');
            if (item.estado === 'desplazado') div.classList.add('item-desplazado');

            var contenido = "<strong>" + item.numeroNuevo + ". " + item.nombre + "</strong>";

            if (item.estado === 'nuevo') {
                contenido += " <span style='color: #28a745; font-size: 0.8em;'>[SE INSERTARÁ AQUÍ]</span>";
            } else if (item.estado === 'desplazado') {
                contenido += " <span style='color: #856404; font-size: 0.8em;'>(Se desplaza: era la " + item.numeroOriginal + ")</span>";
            }

            div.innerHTML = contenido;
            contenedor.appendChild(div);
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        actualizarVistaPrevia();
        document.getElementById('numero').addEventListener('input', actualizarVistaPrevia);
        document.getElementById('nombre').addEventListener('input', actualizarVistaPrevia);
    });

</script>


</body>
</html>
